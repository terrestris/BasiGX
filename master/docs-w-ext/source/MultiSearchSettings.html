<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* Copyright (c) 2016-present terrestris GmbH &amp; Co. KG
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
<span id='BasiGX-view-container-MultiSearchSettings'>/**
</span> *  A container showing settings for the multisearch including switching
 *  gazetter or wfs search on and off, limit search results to visible extent
 *  and configure layers for wfs search.
 *  This class is used by BasiGX.view.form.field.MultiSearchCombo
 *
 * @class BasiGX.view.container.MultiSearchSettings
 *
 * @extends Ext.container.Container
 *
 * @requires BasiGX.util.Layer
 * @requires Ext.form.field.Checkbox
 * @requires Ext.form.FieldContainer
 * @requires Ext.Button
 *
 */
Ext.define(&#39;BasiGX.view.container.MultiSearchSettings&#39;, {
    extend: &#39;Ext.container.Container&#39;,
    xtype: &#39;basigx-container-multisearchsettings&#39;,

    requires: [
        &#39;BasiGX.util.Layer&#39;,
        &#39;Ext.form.field.Checkbox&#39;,
        &#39;Ext.form.FieldContainer&#39;,
        &#39;Ext.Button&#39;
    ],

<span id='BasiGX-view-container-MultiSearchSettings-cfg-viewModel'>    viewModel: {
</span>        data: {
            generalSettingsLabel: &#39;Allgemeine Einstellungen&#39;,
            limitCboxLabel: &#39;Auf den sichtbaren Kartenbereich einschränken&#39;,
            gazetteerLabel: &#39;Gazetteer Suche verwenden&#39;,
            objectSearchLabel: &#39;Objekt Suche verwenden&#39;,
            objectSearchLayersLabel: &#39;Layer für Objektsuche&#39;,
            saveBtnText: &#39;Sucheinstellungen speichern&#39;,
            maxResultCountText: &#39;Maximale Anzahl der Ergebnisse&#39;,
            documentation: &#39;&lt;h2&gt;Multi-Suche&lt;/h2&gt;• Benutzen Sie die &#39; +
                &#39;Mutlisuche, um nach beliebigen Begriffen über mehrere &#39; +
                &#39;Datenquellen hinweg gleichzeitig zu suchen.&lt;br&gt;• Über &#39; +
                &#39;die Einstellungen können Sie das Suchverhalten genauer steuern&#39;
        }
    },

<span id='BasiGX-view-container-MultiSearchSettings-cfg-autoScroll'>    autoScroll: true,
</span>
<span id='BasiGX-view-container-MultiSearchSettings-property-constrainHeader'>    constrainHeader: true,
</span>
<span id='BasiGX-view-container-MultiSearchSettings-cfg-padding'>    padding: 20,
</span>
    config: {
<span id='BasiGX-view-container-MultiSearchSettings-cfg-combo'>        combo: null
</span>    },

<span id='BasiGX-view-container-MultiSearchSettings-cfg-layout'>    layout: &#39;fit&#39;,
</span>
<span id='BasiGX-view-container-MultiSearchSettings-property-items'>    items: [{
</span>        xtype: &#39;form&#39;,
        width: &#39;100%&#39;,
        defaults: {
            labelWidth: 200
        },
        items: [{
            xtype: &#39;fieldcontainer&#39;,
            name: &#39;generalsettings&#39;,
            bind: {
                fieldLabel: &#39;{generalSettingsLabel}&#39;
            },
            defaults: {
                xtype: &#39;checkboxfield&#39;,
                checked: true
            },
            items: [
                {
                    bind: {
                        boxLabel: &#39;{limitCboxLabel}&#39;
                    },
                    name: &#39;limitcheckbox&#39;
                }, {
                    bind: {
                        boxLabel: &#39;{gazetteerLabel}&#39;
                    },
                    name: &#39;gazetteersearch&#39;
                }, {
                    bind: {
                        boxLabel: &#39;{objectSearchLabel}&#39;
                    },
                    name: &#39;objectsearch&#39;
                }
            ]
        }, {
            xtype: &#39;fieldcontainer&#39;,
            name: &#39;resultcount&#39;,
            bind: {
                fieldLabel: &#39;{maxResultCountText}&#39;
            },
            items: [{
                xtype: &#39;numberfield&#39;,
                name: &#39;maxfeatures&#39;,
                minValue: 0,
                maxValue: 50
            }]
        }, {
            xtype: &#39;fieldcontainer&#39;,
            name: &#39;objectlayers&#39;,
            maxHeight: 200,
            scrollable: &#39;y&#39;,
            bind: {
                fieldLabel: &#39;{objectSearchLayersLabel}&#39;
            },
            defaultType: &#39;checkboxfield&#39;
        }],
        dockedItems: [{
            xtype: &#39;toolbar&#39;,
            dock: &#39;bottom&#39;,
            items: [{
                xtype: &#39;button&#39;,
                bind: {
                    text: &#39;{saveBtnText}&#39;
                },
                formBind: true,
                handler: function(btn) {
                    var multisearchSettingsContainer = this.up(&#39;form&#39;).up();
                    multisearchSettingsContainer.saveSettings(btn);
                }
            }]
        }]
    }],

<span id='BasiGX-view-container-MultiSearchSettings-method-initComponent'>    /**
</span>    *
    */
    initComponent: function() {
        var me = this;

        me.callParent();

        if (me.combo) {
            me.setCombo(me.combo);
            me.down(&#39;numberfield[name=maxfeatures]&#39;)
                .setValue(me.getCombo().getMaxFeatures());
        }

        me.on(&#39;beforerender&#39;, me.addLayers);

        var objectSearchCb = me.down(&#39;checkboxfield[name=objectsearch]&#39;);

        objectSearchCb.on(&#39;change&#39;, me.onObjectSearchCbChange, me);
    },

<span id='BasiGX-view-container-MultiSearchSettings-method-onObjectSearchCbChange'>    /**
</span>     *
     * Disables configuration of searchable layers if &quot;Object search&quot; checkbox
     * is unchecked.
     *
     * @param {Ext.form.field.Checkbox} cb Object search checkbox.
     * @param {boolean} checked Whether the checkbox is checked.
     */
    onObjectSearchCbChange: function(cb, checked) {
        var me = this;
        var layersContainer = me.down(&#39;fieldcontainer[name=&quot;objectlayers&quot;]&#39;);
        if (layersContainer) {
            layersContainer.setDisabled(!checked);
        }
    },

<span id='BasiGX-view-container-MultiSearchSettings-method-saveSettings'>    /**
</span>     * Called by &quot;save&quot;-button handler to persist the settings.
     *
     * This includes switching the gazetter or wfs search on and off, limiting
     * search results to visible map extent and configuring search layers.
     *
     * @param {Ext.button.Button} btn The &quot;save&quot;-button.
     */
    saveSettings: function(btn) {

        var settingsContainer = btn.up(&#39;form&#39;).up();

        var win = settingsContainer.up();

        var form = settingsContainer.down(&#39;form&#39;);

        var combo = settingsContainer.getCombo();

        // set configured search layers to null and add the wanted below
        combo.setConfiguredSearchLayers([]);

        // set all configured values
        Ext.each(form.items.items, function(parentItem) {
            if (parentItem.name === &#39;generalsettings&#39;) {

                Ext.each(parentItem.items.items, function(item) {
                    if (item.name === &#39;objectsearch&#39;) {
                        combo.setWfsSearch(item.checked);
                    } else if (item.name === &#39;gazetteersearch&#39;) {
                        combo.setGazetteerSearch(item.checked);
                    } else if (item.name === &#39;limitcheckbox&#39;) {
                        combo.setLimitToBBox(item.checked);
                    }
                });

            } else if (parentItem.name === &#39;objectlayers&#39;) {

                Ext.each(parentItem.items.items, function(item) {
                    var l = BasiGX.util.Layer.getLayerByName(item.name);
                    if (this.checked) {
                        combo.configuredSearchLayers.push(l);
                    }
                });

            } else if (parentItem.name === &#39;resultcount&#39;) {
                var maxFeatures = parentItem.down(&#39;numberfield&#39;).getValue();
                combo.setMaxFeatures(maxFeatures);

            } else {
                Ext.log.error(&#39;Found setting for which no handler exists&#39;);
            }
        });

        win.setLoading(true);
        settingsContainer.combo.refreshSearchResults();
        win.setLoading(false);
        win.close();
    },

<span id='BasiGX-view-container-MultiSearchSettings-method-addLayers'>    /**
</span>    * called by OnBeforerender listener to get all configurable search layers
    * to display them in the settings window
    */
    addLayers: function() {
        var me = this;

        var searchLayers = me.getCombo().getAllSearchLayers();

        var container = me.down(&#39;fieldcontainer[name=&quot;objectlayers&quot;]&#39;);

        Ext.each(searchLayers, function(l) {
            var item = Ext.create(&#39;Ext.form.field.Checkbox&#39;, {
                labelWidth: 200,
                name: l.get(&#39;name&#39;),
                boxLabel: l.get(&#39;name&#39;),
                checked: true
            });

            container.add(item);

        });

    }

});
</pre>
</body>
</html>
